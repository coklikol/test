<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Bot Panel ‚úÖ –†–ê–ë–û–¢–ê–ï–¢</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; }
        input, textarea, button { width: 100%; padding: 12px; margin: 10px 0; box-sizing: border-box; }
        button { background: #0088cc; color: white; border: none; cursor: pointer; font-size: 16px; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        #messages { max-height: 500px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; background: #f9f9f9; }
        .message { margin: 12px 0; padding: 12px; border-radius: 8px; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .message.from-user { border-left: 4px solid #28a745; }
        .message.from-bot { border-left: 4px solid #ffc107; }
        .controls { display: flex; gap: 10px; margin: 10px 0; flex-wrap: wrap; }
        .controls button { flex: 1; min-width: 120px; }
        .clear-btn { background: #dc3545 !important; }
        .load-btn { background: #17a2b8 !important; }
        #debug { background: #e9ecef; padding: 10px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ü§ñ Telegram Bot Panel (–§–ò–ù–ê–õ–¨–ù–ê–Ø)</h1>
    
    <input type="number" id="chatId" value="5407825036" placeholder="Chat ID">
    <textarea id="message" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">—Ç–µ—Å—Ç</textarea>
    
    <div class="controls">
        <button onclick="sendMessage()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button onclick="editMessage()" id="editBtn" disabled>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        <button onclick="startMonitor()" class="load-btn">‚ñ∂Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</button>
        <button onclick="clearMessages()" class="clear-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
    
    <div id="status"></div>
    
    <h3>üì± –°–æ–æ–±—â–µ–Ω–∏—è (–í–°–ï):</h3>
    <div id="messages">–ù–∞–∂–º–∏—Ç–µ "‚ñ∂Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥" –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É —Å–æ–æ–±—â–µ–Ω–∏–µ!</div>
    
    <h4>üêõ Debug –ª–æ–≥:</h4>
    <div id="debug"></div>

    <script>
        const BOT_TOKEN = '6639181665:AAF98IaosMehuMvoKy3vqw5KbudGw96R9jk';
        const API_URL = `https://api.telegram.org/bot${BOT_TOKEN}`;
        let messages = [];
        let offset = 0;
        let monitorInterval = null;

        function showStatus(text, isError = false) {
            const status = document.getElementById('status');
            status.textContent = text;
            status.className = `status ${isError ? 'error' : 'success'}`;
            debugLog(text);
        }

        function debugLog(text) {
            const debug = document.getElementById('debug');
            debug.innerHTML += `[${new Date().toLocaleTimeString()}] ${text}\n`;
            debug.scrollTop = debug.scrollHeight;
        }

        async function apiCall(method, params = {}) {
            const response = await fetch(`${API_URL}/${method}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(params)
            });
            return await response.json();
        }

        async function sendMessage() {
            const chatId = document.getElementById('chatId').value;
            const text = document.getElementById('message').value;
            
            if (!chatId || !text) return showStatus('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è!', true);

            try {
                const data = await apiCall('sendMessage', { chat_id: chatId, text });
                if (data.ok) {
                    showStatus('‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
                    if (monitorInterval) getUpdates(); // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
                } else {
                    showStatus(`‚ùå ${data.description}`, true);
                }
            } catch (error) {
                showStatus(`‚ùå ${error.message}`, true);
            }
        }

        // üî• –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê
        async function getUpdates() {
            try {
                const data = await apiCall('getUpdates', { 
                    offset: offset, 
                    limit: 20, 
                    timeout: 10 
                });

                debugLog(`API –≤–µ—Ä–Ω—É–ª ${data.result?.length || 0} –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π`);

                if (data.ok && data.result) {
                    for (let update of data.result) {
                        offset = update.update_id + 1;
                        
                        if (update.message) {
                            const msg = update.message;
                            const fromName = msg.from?.first_name || 
                                           msg.from?.username || 
                                           msg.from?.id || 'Unknown';
                            
                            // –î–û–ë–ê–í–õ–Ø–ï–ú –ë–ï–ó –§–ò–õ–¨–¢–†–û–í - –ü–û–ö–ê–ó–´–í–ê–ï–ú –í–°–ï!
                            messages.unshift({
                                id: msg.message_id,
                                from: fromName,
                                chatId: msg.chat.id,
                                text: msg.text || '[–º–µ–¥–∏–∞]',
                                date: new Date(msg.date * 1000).toLocaleString('ru-RU'),
                                isBot: msg.from?.is_bot || false
                            });
                            
                            debugLog(`üí¨ –ù–æ–≤–æ–µ: [${msg.chat.id}] ${fromName}: ${msg.text}`);
                        }
                    }
                    
                    displayMessages();
                    showStatus(`‚úÖ ${data.result.length} –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π`);
                }
            } catch (error) {
                debugLog(`–û—à–∏–±–∫–∞ API: ${error.message}`);
            }
        }

        function displayMessages() {
            const container = document.getElementById('messages');
            const html = messages.slice(0, 50).map(msg => `
                <div class="message ${msg.isBot ? 'from-bot' : 'from-user'}">
                    <div style="display: flex; justify-content: space-between;">
                        <strong>${msg.from}</strong>
                        <small>${msg.date}</small>
                    </div>
                    <div style="margin-top: 5px; word-break: break-word;">
                        üì± –ß–∞—Ç: ${msg.chatId}<br>
                        üí¨ ${msg.text}
                    </div>
                </div>
            `).join('') || '<em>–°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É —á—Ç–æ-–Ω–∏–±—É–¥—å!</em>';
            
            container.innerHTML = html;
            container.scrollTop = 0;
        }

        function startMonitor() {
            if (monitorInterval) {
                clearInterval(monitorInterval);
                showStatus('‚èπÔ∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                return;
            }
            
            showStatus('‚ñ∂Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ó–ê–ü–£–©–ï–ù!');
            getUpdates(); // –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
            monitorInterval = setInterval(getUpdates, 3000); // –ö–∞–∂–¥—ã–µ 3 —Å–µ–∫
        }

        function clearMessages() {
            messages = [];
            displayMessages();
            showStatus('üóëÔ∏è –û—á–∏—â–µ–Ω–æ');
        }

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keypress', (e) => {
            if (e.ctrlKey && e.key === 'Enter') sendMessage();
            if (e.ctrlKey && e.key === 'm') startMonitor();
        });
    </script>
</body>
</html>
